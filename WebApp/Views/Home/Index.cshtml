@using Microsoft.CodeAnalysis.CSharp.Syntax
@using Model
@model WebApp.Models.SummonerViewModel

@{
    ViewData["Title"] = "SummonerLookup";
}

<h2>SummonerLookup</h2>

<h4>SummonerViewModel</h4>
<hr />
<div class="row">
<div class="col-md-4"></div>
<div class="col-md-4 summoner-input-area">
    <form asp-action="Index">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <div class="form-group">
            <label asp-for="SummonerName" class="control-label"></label>
            <input asp-for="SummonerName" class="form-control" value="FriendlyRob"/>
            <span asp-validation-for="SummonerName" class="text-danger"></span>
        </div>
        <div class="form-group">
            @Html.DropDownListFor(model => model.Region, new SelectList(ViewBag.RegionList))
        </div>
        <div class="form-group">
            <input type="submit" value="Lookup" class="btn btn-default"/>
        </div>
    </form>
</div>
<div class="col-md-4"></div>
    @if (ViewBag.Summoner != null)
    {
    <div class="col-md-12" style="border: 1px solid red">
    <div class="summoner">
        <div class="profile-icon">
            <img src="~/images/profileicon/@(ViewBag.Summoner.ProfileIconId).png" class="profile-icon-image">
        </div>
        <div class="summoner-info">
            <div class="summoner-name">@TempData["SummonerName"]</div>
            <div class="summoner-level">Level: @TempData["SummonerLevel"]</div>
        </div>
    </div>
    @if (ViewBag.SummonerRanks != null)
    {
        <div class="summoner-ranks">
            <div class="rank-tabs-buttons">
                @foreach (var rank in ViewBag.SummonerRanks)
                {
                    switch (rank.QueueType)
                    {
                        // TODO: Order these by order set underneath
                        case "RANKED_SOLO_5x5":
                            <button onclick="openRank('Solo-5x5')">Solo 5x5</button>
                            break;
                        case "RANKED_FLEX_SR":
                            <button onclick="openRank('Flex-5x5')">Flex 5x5</button>
                            break;
                        case "RANKED_FLEX_TT":
                            <button onclick="openRank('Flex-3x3')">Flex 3x3</button>
                            break;
                        case "RANKED_TFT":
                            <button onclick="openRank('TFT')">TFT</button>
                            break;
                        default:
                            <span>No Rank Found</span>
                            break;
                    }
                }
            </div>
            <div class="rank-tabs">
                @foreach (var rank in ViewBag.SummonerRanks)
                {
                    switch (rank.QueueType)
                    {
                        case "RANKED_SOLO_5x5":
                            <div id="Solo-5x5" class="rank-tab">
                                <div class="rank-icon">
                                    <img src="~/images/ranks/Emblem_@(rank.Tier).png" class="rank-icon-image" alt="Rank-Tier">
                                </div>
                                <div class="rank-info">
                                    <h2>Solo 5x5</h2>
                                    <div>@rank.Tier @rank.Division @rank.LeaguePoints LP</div>
                                    <div>W:@rank.Wins L:@rank.Losses</div>
                                </div>
                            </div>
                            break;
                        case "RANKED_FLEX_SR":
                            <div id="Flex-5x5" class="rank-tab" style="display: none">
                                <div class="rank-icon">
                                    <img src="~/images/ranks/Emblem_@(rank.Tier).png" class="rank-icon-image" alt="Rank-Tier">
                                </div>
                                <div class="rank-info">
                                    <h2>Flex 5x5</h2>
                                    <div>@rank.Tier @rank.Division @rank.LeaguePoints LP</div>
                                    <div>W :@rank.Wins L: @rank.Losses</div>
                                </div>
                            </div>
                            break;
                        case "RANKED_FLEX_TT":
                            <div id="Flex-3x3" class="rank-tab" style="display: none">
                                <div class="rank-icon">
                                    <img src="~/images/ranks/Emblem_@(rank.Tier).png" class="rank-icon-image" alt="Rank-Tier">
                                </div>
                                <div class="rank-info">
                                    <h2>Flex 3x3</h2>
                                    <div>@rank.Tier @rank.Division @rank.LeaguePoints LP</div>
                                    <div>W :@rank.Wins L: @rank.Losses</div>
                                </div>
                            </div>
                            break;
                        case "RANKED_TFT":
                            <div id="TFT" class="rank-tab" style="display: none">
                                <div class="rank-icon">
                                    <img src="~/images/ranks/Emblem_@(rank.Tier).png" class="rank-icon-image" alt="Rank-Tier">
                                </div>
                                <div class="rank-info">
                                    <h2>TFT</h2>
                                    <div>@rank.Tier @rank.Division @rank.LeaguePoints LP</div>
                                    <div>W :@rank.Wins L: @rank.Losses</div>
                                </div>
                            </div>
                            break;
                        default:
                            <span>No Rank Found</span>
                            break;
                    }
                }
            </div>
        </div>
    }
    @if (ViewBag.PlayedGames != null)
    {
        <div class="played-games-history-list">
            @foreach (var game in ViewBag.PlayedGames)
            {
                <div class="played-game-wrap">
                    <div class="played-game" id="@game.GameId" title="GameId: @game.GameId">
                        <div class="played-game-champion-icon">

                            @*@if (game.Season != 3)
                                    {
                                        var playerIdentity = game.participantIdentities.Single(s => s.ParticipantId == ViewBag.Summoner.Name);
                                        var asd = game.participantIdentities.Find(x => x.GetId() == "xy");
                                        var currentSummoner = game.participantIdentities.player.summonername == ViewBag.Summoner.Name;
                                        //<img src="" id="summoner-champion-@game.GameId"/>

                                        <img src="~/images/champion/@(@game.ChampionObject.ChampionName).png" id="summoner-champion-@game.GameId" class="played-game-champion-icon-image" title="ChampionID: @game.ChampionId | @game.ChampionObject.ChampionName" alt="Champion">
                                    }*@
                        </div>
                        <div class="played-game-info">
                            <div class="queueTypeGame" title="QueueTypeId: @game.QueueTypeId">QueueType: @game.QueueType.Description</div>
                            <div class="timeSinceGame" title="@game.DateCreated.ToString("dd-MM-yyyy HH:mm:ss")">
                                Time since:
                                @{
                                    TimeSpan timeSince = DateTime.Now.Subtract(game.DateCreated);
                                    double timeSinceInDays = (Math.Floor(timeSince.TotalDays));
                                    double timeSinceInHours = (Math.Floor(timeSince.TotalHours));
                                }
                                @switch (timeSinceInDays)
                                {
                                    case 0:

                                        switch (timeSinceInHours)
                                        {
                                            case 0:
                                                @Math.Floor(timeSince.TotalMinutes)
                                                @: Minutes ago
                                                break;
                                            case 1:
                                                @:1 Hour ago
                                                break;
                                            default:
                                                @timeSinceInHours
                                                @: Hours ago
                                                break;
                                        }
                                        break; // TODO: check: Will it ever reach this break?
                                    case 1:
                                        @:1 day ago
                                        break;
                                    default:
                                        @timeSinceInDays
                                        @: Days ago
                                        break;
                                }
                            </div>
                        </div>


                        @if (game.PlayedGameTeams != null)
                        {

                            <div class="teams-wrap">
                                @foreach (var team in game.PlayedGameTeams)
                                {
                                    <div class="team-block">
                                        <div>TeamId: @team.TeamId</div>
                                        <div>@team.Win</div>

                                        @foreach (var player in team.PlayedGamePlayers)
                                        {
                                                @*if (player.SummonerName == ViewBag.Summoner.Name)
                                                {
                                                    <script>$("#summoner-champion-@game.GameId").attr("src", "~/images/champion/@(player.ChampionObject.ChampionName).png");</script>
                                                }*@
                                            <div class="player-block">
                                                <div class="player-champion-summspells-section">
                                                    <div><img src="~/images/champion/@(@player.ChampionObject.KeyName).png" class="played-game-champion-icon-image" title="@player.ChampionObject.ChampionName | ChampionID: @player.ChampionId" alt="Champion @player.ChampionObject.ChampionName"></div>
                                                    <div class="player-summoner-spells">
                                                        @if (player.SummonerSpell1Object != null && player.SummonerSpell2Object != null)
                                                        {
                                                            <img src="~/images/spell/@(@player.SummonerSpell1Object.KeyName).png" class="player-summoner-spell-image" title="Spell1: @player.SummonerSpell1Id"/>
                                                            <img src="~/images/spell/@(@player.SummonerSpell2Object.KeyName).png" class="player-summoner-spell-image" title="Spell2: @player.SummonerSpell2Id"/>
                                                        }
                                                    </div>
                                                </div>
                                                <div class="player-info">
                                                    <div class="player-name"><a class="player-name-link">@player.SummonerName</a></div>
                                                    <div class="player-kda-full"><b>@player.PlayerStats.Kills / @player.PlayerStats.Deaths / @player.PlayerStats.Assists</b></div>
                                                    @if (player.PlayerStats.Deaths > 0)
                                                    {
                                                        float kda = (float) @player.PlayerStats.Kills + (float) @player.PlayerStats.Assists / (float) @player.PlayerStats.Deaths;
                                                        <div class="player-kda"><b>@($"{kda:n2}") KDA</b></div>
                                                    }
                                                    else
                                                    {
                                                        <div class="player-kda"><b>Perfect KDA</b></div>
                                                    }
                                                    <div class="player-cs"><img src="~/images/ui/minion.png" class="minion-image" title="minionImage" alt="Minion"> CS: @player.PlayerStats.TotalMinionsKilled</div>

                                                </div>
                                                <div class="player-items">
                                                    @if (player.PlayerStats.Item0Object != null)
                                                    {
                                                        <div class="player-item" title="ID: @player.PlayerStats.Item0 Name: @player.PlayerStats.Item0Object.Name">
                                                            <img src="~/images/item/@(@player.PlayerStats.Item0).png" class="player-item-image" alt="Item" />
                                                        </div>
                                                    }
                                                    @if (player.PlayerStats.Item1Object != null)
                                                    {
                                                        <div class="player-item" title="ID: @player.PlayerStats.Item1 Name: @player.PlayerStats.Item1Object.Name">
                                                            <img src="~/images/item/@(@player.PlayerStats.Item1).png" class="player-item-image" alt="Item" />
                                                        </div>
                                                    }
                                                    @if (player.PlayerStats.Item2Object != null)
                                                    {
                                                        <div class="player-item" title="ID: @player.PlayerStats.Item2 Name: @player.PlayerStats.Item2Object.Name">
                                                            <img src="~/images/item/@(@player.PlayerStats.Item2).png" class="player-item-image" alt="Item" />
                                                        </div>
                                                    }
                                                    @if (player.PlayerStats.Item6Object != null)
                                                    {
                                                        <div class="player-item" title="ID: @player.PlayerStats.Item6 Name: @player.PlayerStats.Item6Object.Name">
                                                            <img src="~/images/item/@(@player.PlayerStats.Item6).png" class="player-item-image" alt="Item" />
                                                        </div>
                                                    }
                                                    @if (player.PlayerStats.Item3Object != null)
                                                    {
                                                        <div class="player-item" title="ID: @player.PlayerStats.Item3 Name: @player.PlayerStats.Item3Object.Name">
                                                            <img src="~/images/item/@(@player.PlayerStats.Item3).png" class="player-item-image" alt="Item" />
                                                        </div>
                                                    }
                                                    @if (player.PlayerStats.Item4Object != null)
                                                    {
                                                        <div class="player-item" title="ID: @player.PlayerStats.Item4 Name: @player.PlayerStats.Item4Object.Name">
                                                            <img src="~/images/item/@(@player.PlayerStats.Item4).png" class="player-item-image" alt="Item" />
                                                        </div>
                                                    }
                                                    @if (player.PlayerStats.Item5Object != null)
                                                    {
                                                        <div class="player-item" title="ID: @player.PlayerStats.Item5 Name: @player.PlayerStats.Item5Object.Name">
                                                            <img src="~/images/item/@(@player.PlayerStats.Item5).png" class="player-item-image" alt="Item" />
                                                        </div>
                                                    }


                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                            </div>
                        }

                    </div>
                </div>
            }
        </div>
    }

    </div>
}
</div>
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
